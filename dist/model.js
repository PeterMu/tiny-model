!function(e){if("function"==typeof define&&define.amd)define(["jquery"],function(t){return e(t)});else if("function"==typeof define&&define.cmd)define(function(t,s,i){var o=t("jquery");return e(o)});else if(window.jQuery){var t=e(window.jQuery);window.Model=t}else console&&console.error("U need to load jquery!")}(function(e){var t=e,s=function(e){this._config=e||{},this._config=t.extend(!0,{before:null,complete:null,error:null,sendType:"form",dataType:"json",xsrf:null,showMask:!1,maskClass:"mask",disableEl:null,disableClass:"disabled",hasToken:!0,baseUrl:"",codeKey:"status.code",msgKey:"status.message",successCode:1,xhrFields:null,headers:{}},this._config),this.init()};return s.prototype.init=function(){var e=this._config.modelConfig;if(e)for(var t in e)this[t]=this.buildReq(e[t])},s.prototype.buildReq=function(e){var t=this.parseUrl(e.url,e.hasToken,e._xsrf),s=this.getConfig("sendType",e.sendType),i=this.getConfig("dataType",e.dataType),o=this;return function(n,r,a){var d=(new Date).getTime();return"function"==typeof n&&(r=n,a=r,n=null),o._beforeProcess(n,e),o._send(t,n,e.method||"GET",s,i,e,function(s,i,n,f){o._afterProcess(s,i,t,d,e),s?a&&a(s,e):r&&r(i,n,f)})}},s.prototype.getStatus=function(e,t,s){var i=null,o=null;if(t=this.getConfig("codeKey",t).split("."),s=this.getConfig("msgKey",s).split("."),t)for(var n=0,r=t.length;n<r;n++)i=i?i[t[n]]:e[t[n]];if(s)for(var n=0,r=s.length;n<r;n++)o=o?o[s[n]]:e[s[n]];return{code:i,msg:o}},s.prototype._beforeProcess=function(e,s){var i=this.getConfig("showMask",s.showMask),o=this.getConfig("disableEl",s.disableEl),n=this.getConfig("disableClass",s.disableClass),r=this.getConfig("before",s.before);i&&this._showMask(),o&&t(o).addClass(n),r&&r(e,s)},s.prototype._afterProcess=function(e,s,i,o,n){var r=null,a=this.getConfig("showMask",n.showMask),d=this.getConfig("disableEl",n.disableEl),f=this.getConfig("disableClass",n.disableClass),l=this.getConfig("complete",n.complete),u=this.getConfig("error",n.error);if(e)u&&u(e,n);else{var h=this.getStatus(s,n.codeKey,n.msgKey);r=this.getConfig("successCode",n.successCode),l&&l(s,h.code==r,h,n)}a&&this._hideMask(),d&&t(d).removeClass(f)},s.prototype._showMask=function(){this.$mask=this.$mask||t('<div id="model-mask"><div class="'+this._config.maskClass+'"></div></div>'),0===t("#model-mask").length&&t(document.body).append(this.$mask),this.$mask.show()},s.prototype._hideMask=function(){this.$mask.hide()},s.prototype.getConfig=function(e,t){return void 0===t?this._config[e]:t},s.prototype.parseUrl=function(e,t,s){if(t=this.getConfig("hasToken",t),s=this.getConfig("xsrf",s),this._config.baseUrl&&(e=this._config.baseUrl+e),t&&(e=this.addQueryParam(e,"t",(new Date).getTime())),s)if("function"==typeof s){var i=s()||{};e=this.addQueryParam(e,i.name,i.value)}else e=this.addQueryParam(e,s,this._getCookie(s));return e},s.prototype.addQueryParam=function(e,t,s){return e=e.indexOf("?")!=-1?e+"&"+t+"="+s:e+"?"+t+"="+s},s.prototype._getCookie=function(e){var t=new RegExp("(?:^|;+|\\s+)"+e+"=([^;]*)"),s=document.cookie.match(t);return s?s[1]:""},s.prototype._send=function(e,s,i,o,n,r,a){var d=t.Deferred(),f={url:e,type:i},l=this;return o=this.getConfig("sendType",o),f.dataType=this.getConfig("dataType",n),"json"===o&&"GET"!=i.toUpperCase()&&(s=JSON.stringify(s),f.contentType="application/json; charset=UTF-8"),f.data=s,f.error=function(e,t){var s={status:e.status,textStatus:t};a(s,null),d.reject(s)},f.success=function(e,t){var s=l.getStatus(e,r.codeKey,r.msgKey),i=l.getConfig("successCode",r.successCode);a(null,e,s.code===i,s),d.resolve(e,s.code===i,s)},f.xhrFields=this.getConfig("xhrFields",r.xhrFields),f.headers=this.getConfig("headers",r.headers),t.ajax(f),d},s});