!function(e){if("function"==typeof define&&define.amd)define(["jquery"],function(t){return e(t)});else if("function"==typeof define&&define.cmd)define(function(t,s,o){var i=t("jquery");return e(i)});else if(window.jQuery){var t=e(window.jQuery);window.Model=t}else console&&console.error("U need to load jquery!")}(function(e){var t=e,s=function(e){this._config=e||{},this._config=t.extend(!0,{before:null,complete:null,error:null,sendType:"form",dataType:"json",xsrf:null,showMask:!1,maskClass:"mask",disableEl:null,disableClass:"disabled",hasToken:!0,baseUrl:"",codeKey:"status.code",msgKey:"status.message",successCode:1,xhrFields:null,headers:{}},this._config),this.init()};return s.prototype.init=function(){var e=this._config.modelConfig;if(e)for(var t in e)this[t]=this.buildReq(e[t])},s.prototype.buildReq=function(e){var t=this.getConfig("sendType",e.sendType),s=this.getConfig("dataType",e.dataType),o=this;return function(i,n,r){var a=(new Date).getTime(),f="";return"function"==typeof i&&(n=i,r=n,i=null),f=o.parseUrl(e.url,i,e.hasToken,e._xsrf),o._beforeProcess(i,e),i=o.mergeParams(i,e.data),o._send(f,i,e.method||"GET",t,s,e,function(t,s,i,d){o._afterProcess(t,s,f,a,e),t?r&&r(t,e):n&&n(s,i,d)})}},s.prototype.mergeParams=function(e,t){if(t){e=e||{};for(var s in t)e[s]||(e[s]=t[s])}return e},s.prototype.getStatus=function(e,t,s){var o=null,i=null;if(t=this.getConfig("codeKey",t).split("."),s=this.getConfig("msgKey",s).split("."),t)for(var n=0,r=t.length;n<r;n++)o=o?o[t[n]]:e[t[n]];if(s)for(var n=0,r=s.length;n<r;n++)i=i?i[s[n]]:e[s[n]];return{code:o,msg:i}},s.prototype._beforeProcess=function(e,s){var o=this.getConfig("showMask",s.showMask),i=this.getConfig("disableEl",s.disableEl),n=this.getConfig("disableClass",s.disableClass),r=this.getConfig("before",s.before);o&&this._showMask(),i&&t(i).addClass(n),r&&r(e,s)},s.prototype._afterProcess=function(e,s,o,i,n){var r=null,a=this.getConfig("showMask",n.showMask),f=this.getConfig("disableEl",n.disableEl),d=this.getConfig("disableClass",n.disableClass),l=this.getConfig("complete",n.complete),u=this.getConfig("error",n.error);if(e)u&&u(e,n,i);else{var c=this.getStatus(s,n.codeKey,n.msgKey);r=this.getConfig("successCode",n.successCode),l&&l(s,c.code==r,c,n,i,e)}a&&this._hideMask(),f&&t(f).removeClass(d)},s.prototype._showMask=function(){this.$mask=this.$mask||t('<div id="model-mask"><div class="'+this._config.maskClass+'"></div></div>'),0===t("#model-mask").length&&t(document.body).append(this.$mask),this.$mask.show()},s.prototype._hideMask=function(){this.$mask.hide()},s.prototype.getConfig=function(e,t){return void 0===t?this._config[e]:t},s.prototype.parseUrl=function(e,t,s,o){if(e=e||"",t=t||{},s=this.getConfig("hasToken",s),o=this.getConfig("xsrf",o),/:(\w+)/.test(e)&&(e=e.replace(/:(\w+)/g,function(s,o){if(t[o]){var i=t[o];return delete t[o],i}return console.error("tiny-model: the url",e,"need param",o),s})),this._config.baseUrl&&(e=this._config.baseUrl+e),s&&(e=this.addQueryParam(e,"t",(new Date).getTime())),o)if("function"==typeof o){var i=o()||{};e=this.addQueryParam(e,i.name,i.value)}else e=this.addQueryParam(e,o,this._getCookie(o));return e},s.prototype.addQueryParam=function(e,t,s){return e=e.indexOf("?")!=-1?e+"&"+t+"="+s:e+"?"+t+"="+s},s.prototype._getCookie=function(e){var t=new RegExp("(?:^|;+|\\s+)"+e+"=([^;]*)"),s=document.cookie.match(t);return s?s[1]:""},s.prototype._send=function(e,s,o,i,n,r,a){var f=t.Deferred(),d={url:e,type:o},l=this;return i=this.getConfig("sendType",i),d.dataType=this.getConfig("dataType",n),"json"===i&&"GET"!=o.toUpperCase()&&(s=JSON.stringify(s),d.contentType="application/json; charset=UTF-8"),d.data=s,d.error=function(e,t){var s={status:e.status,textStatus:t};a(s,null),f.reject(s)},d.success=function(e,t){var s=l.getStatus(e,r.codeKey,r.msgKey),o=l.getConfig("successCode",r.successCode);a(null,e,s.code===o,s),f.resolve(e,s.code===o,s)},d.xhrFields=this.getConfig("xhrFields",r.xhrFields),d.headers=this.getConfig("headers",r.headers),t.ajax(d),f},s});