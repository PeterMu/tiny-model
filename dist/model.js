!function(e){if("function"==typeof define&&(define.cmd||define.amd))define(["jquery"],function(s){return e(s)});else if(window.jQuery){var s=e(window.jQuery);window.Model=s}else console&&console.error("U need to load jquery!")}(function(e){var s=e,t=function(e){this._config=e||{},this._config=s.extend(!0,{before:null,complete:null,error:null,sendType:"form",dataType:"json",xsrf:null,showMask:!1,maskClass:"mask",disableEl:null,disableClass:"disabled",hasToken:!0,baseUrl:"",codeKey:"status.code",msgKey:"status.message",successCode:1,xhrFields:null,headers:{}},this._config),this.init()};return t.prototype.init=function(){var e=this._config.modelConfig;if(e)for(var s in e)this[s]=this.buildReq(e[s])},t.prototype.buildReq=function(e){var s=this.parseUrl(e.url,e.hasToken,e._xsrf),t=this.getConfig("sendType",e.sendType),o=this.getConfig("dataType",e.dataType),i=this;return function(n,a,r){var d=(new Date).getTime();return"function"==typeof n&&(a=n,r=a,n=null),i._beforeProcess(n,e),i._send(s,n,e.method||"GET",t,o,e,function(t,o,n,f){i._afterProcess(t,o,s,d,e),t?r&&r(t,e):a&&a(o,n,f)})}},t.prototype.getStatus=function(e,s,t){var o=null,i=null;if(s=this.getConfig("codeKey",s).split("."),t=this.getConfig("msgKey",t).split("."),s)for(var n=0,a=s.length;a>n;n++)o=o?o[s[n]]:e[s[n]];if(t)for(var n=0,a=t.length;a>n;n++)i=i?i[t[n]]:e[t[n]];return{code:o,msg:i}},t.prototype._beforeProcess=function(e,t){var o=this.getConfig("showMask",t.showMask),i=this.getConfig("disableEl",t.disableEl),n=this.getConfig("disableClass",t.disableClass),a=this.getConfig("before",t.before);o&&this._showMask(),i&&s(i).addClass(n),a&&a(e,t)},t.prototype._afterProcess=function(e,t,o,i,n){var a=null,r=this.getConfig("showMask",n.showMask),d=this.getConfig("disableEl",n.disableEl),f=this.getConfig("disableClass",n.disableClass),l=this.getConfig("complete",n.complete),h=this.getConfig("error",n.error);if(e)h&&h(e,n);else{var u=this.getStatus(t,n.codeKey,n.msgKey);a=this.getConfig("successCode",n.successCode),l&&l(t,u.code==a,u,n)}r&&this._hideMask(),d&&s(d).removeClass(f)},t.prototype._showMask=function(){this.$mask=this.$mask||s('<div id="model-mask"><div class="'+this._config.maskClass+'"></div></div>'),0===s("#model-mask").length&&s(document.body).append(this.$mask),this.$mask.show()},t.prototype._hideMask=function(){this.$mask.hide()},t.prototype.getConfig=function(e,s){return void 0===s?this._config[e]:s},t.prototype.parseUrl=function(e,s,t){if(s=this.getConfig("hasToken",s),t=this.getConfig("xsrf",t),this._config.baseUrl&&(e=this._config.baseUrl+e),s&&(e=this.addQueryParam(e,"t",(new Date).getTime())),t)if("function"==typeof t){var o=t()||{};e=this.addQueryParam(e,o.name,o.value)}else e=this.addQueryParam(e,t,this._getCookie(t));return e},t.prototype.addQueryParam=function(e,s,t){return e=-1!=e.indexOf("?")?e+"&"+s+"="+t:e+"?"+s+"="+t},t.prototype._getCookie=function(e){var s=new RegExp("(?:^|;+|\\s+)"+e+"=([^;]*)"),t=document.cookie.match(s);return t?t[1]:""},t.prototype._send=function(e,t,o,i,n,a,r){var d=s.Deferred(),f={url:e,type:o},l=this;return i=this.getConfig("sendType",i),f.dataType=this.getConfig("dataType",n),"json"===i&&"GET"!=o.toUpperCase()&&(t=JSON.stringify(t),f.contentType="application/json; charset=UTF-8"),f.data=t,f.error=function(e,s){var t={status:e.status,textStatus:s};r(t,null),d.reject(t)},f.success=function(e,s){var t=l.getStatus(e,a.codeKey,a.msgKey),o=l.getConfig("successCode",a.successCode);r(null,e,t.code===o,t),d.resolve(e,t.code===o,t)},f.xhrFields=this.getConfig("xhrFields",a.xhrFields),f.headers=this.getConfig("headers",a.headers),s.ajax(f),d},t});