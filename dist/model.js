!function(e){if("function"==typeof define&&(define.cmd||define.amd))define(function(s){var t=s("jquery");return e(t)});else if(window.jQuery){var s=e(window.jQuery);window.Model=s}else console&&console.error("U need to load jquery!")}(function(e){var s=e,t=function(e){this._config=e||{},this._config=s.extend(!0,{before:null,complete:null,error:null,sendType:"form",dataType:"json",xsrf:null,showMask:!1,maskClass:"mask",disableEl:null,disableClass:"disabled",hasToken:!0,baseUrl:"",codeKey:"status.code",msgKey:"status.message",successCode:1,xhrFields:null,headers:{}},this._config),this.init()};return t.prototype.init=function(){var e=this._config.modelConfig;if(e)for(var s in e)this[s]=this.buildReq(e[s])},t.prototype.buildReq=function(e){var s=this.parseUrl(e.url,e.hasToken,e._xsrf),t=this.getConfig("sendType",e.sendType),i=this.getConfig("dataType",e.dataType),o=this;return function(n,a,r){var d=(new Date).getTime();return"function"==typeof n&&(a=n,r=a,n=null),o._beforeProcess(n,e),o._send(s,n,e.method||"GET",t,i,e,function(t,i,n,f){o._afterProcess(t,i,s,d,e),t?r&&r(t,e):a&&a(i,n,f)})}},t.prototype.getStatus=function(e,s,t){var i=null,o=null;if(s=this.getConfig("codeKey",s).split("."),t=this.getConfig("msgKey",t).split("."),s)for(var n=0,a=s.length;a>n;n++)i=i?i[s[n]]:e[s[n]];if(t)for(var n=0,a=t.length;a>n;n++)o=o?o[t[n]]:e[t[n]];return{code:i,msg:o}},t.prototype._beforeProcess=function(e,t){var i=this.getConfig("showMask",t.showMask),o=this.getConfig("disableEl",t.disableEl),n=this.getConfig("disableClass",t.disableClass),a=this.getConfig("before",t.before);i&&this._showMask(),o&&s(o).addClass(n),a&&a(e,t)},t.prototype._afterProcess=function(e,t,i,o,n){var a=null,r=this.getConfig("showMask",n.showMask),d=this.getConfig("disableEl",n.disableEl),f=this.getConfig("disableClass",n.disableClass),l=this.getConfig("complete",n.complete),h=this.getConfig("error",n.error);if(e)h&&h(e,n);else{var g=this.getStatus(t,n.codeKey,n.msgKey);a=this.getConfig("successCode",n.successCode),l&&l(t,g.code==a,g,n)}r&&this._hideMask(),d&&s(d).removeClass(f)},t.prototype._showMask=function(){this.$mask=this.$mask||s('<div id="model-mask"><div class="'+this._config.maskClass+'"></div></div>'),0===s("#model-mask").length&&s(document.body).append(this.$mask),this.$mask.show()},t.prototype._hideMask=function(){this.$mask.hide()},t.prototype.getConfig=function(e,s){return void 0===s?this._config[e]:s},t.prototype.parseUrl=function(e,s,t){if(s=this.getConfig("hasToken",s),t=this.getConfig("xsrf",t),this._config.baseUrl&&(e=this._config.baseUrl+e),s&&(e=this.addQueryParam(e,"t",(new Date).getTime())),t)if("function"==typeof t){var i=t()||{};e=this.addQueryParam(e,i.name,i.value)}else e=this.addQueryParam(e,t,this._getCookie(t));return e},t.prototype.addQueryParam=function(e,s,t){return e=-1!=e.indexOf("?")?e+"&"+s+"="+t:e+"?"+s+"="+t},t.prototype._getCookie=function(e){var s=new RegExp("(?:^|;+|\\s+)"+e+"=([^;]*)"),t=document.cookie.match(s);return t?t[1]:""},t.prototype._send=function(e,t,i,o,n,a,r){var d={url:e,type:i},f=this;return o=this.getConfig("sendType",o),d.dataType=this.getConfig("dataType",n),"json"===o&&"GET"!=i.toUpperCase()&&(t=JSON.stringify(t),d.contentType="application/json; charset=UTF-8"),d.data=t,d.error=function(e,s){r(s,null)},d.success=function(e,s){var t=f.getStatus(e,a.codeKey,a.msgKey),i=f.getConfig("successCode",a.successCode);r(null,e,t.code===i,t)},d.xhrFields=this.getConfig("xhrFields",a.xhrFields),d.headers=this.getConfig("headers",a.headers),s.ajax(d)},t});